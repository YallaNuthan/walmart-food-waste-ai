<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Walmart Waste Predictor</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background-color: #f4f6f9; margin: 0; padding: 0; overflow-x: hidden; }
    .sidebar { height: 100%; width: 250px; position: fixed; top: 0; left: -250px; background-color: #003087; overflow-x: hidden; transition: 0.3s; padding-top: 60px; z-index: 1000; }
    .sidebar a { padding: 16px 24px; text-decoration: none; font-size: 18px; color: #fff; display: block; }
    .sidebar a:hover { background-color: #0050c2; }
    .openbtn { font-size: 24px; cursor: pointer; background-color: #003087; color: white; padding: 12px 18px; border: none; position: fixed; top: 10px; left: 10px; z-index: 1100; }
    .bell-icon { position: fixed; top: 14px; right: 20px; font-size: 24px; cursor: pointer; z-index: 1100; }
    .alert-box { position: fixed; top: 50px; right: 20px; width: 320px; max-height: 400px; overflow-y: auto; background: white; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); padding: 16px; display: none; z-index: 1200; }
    #main { transition: margin-left 0.3s; padding: 20px; margin-left: 0; }
    .container { background-color: white; border-radius: 10px; padding: 30px; margin: 20px auto; max-width: 1100px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #003087; }
    button { background-color: #0071ce; color: white; padding: 10px 20px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin: 8px 10px 8px 0; }
    button:hover { background-color: #005bbb; }
    .page { display: none; }
    .active { display: block !important; }
    .welcome { text-align: center; margin-top: 100px; font-size: 26px; color: #003087; padding: 0 20px; }
    .sim-box { background: #eaf7ec; border-radius: 8px; padding: 20px; margin-top: 20px; animation: fadeIn 1s ease-in-out; }
    .sim-result p { font-size: 16px; margin: 8px 0; }
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    .upgrade-card { border: 2px dashed #6b8e23; border-radius: 10px; padding: 15px; margin-top: 15px; background: #fdfdfd; animation: pulse 2s infinite; }
    @keyframes pulse {
      0% {box-shadow: 0 0 0 0 rgba(107, 142, 35, 0.5);}
      70% {box-shadow: 0 0 0 10px rgba(107, 142, 35, 0);}
      100% {box-shadow: 0 0 0 0 rgba(107, 142, 35, 0);}
    }
    .store-scoreboard p { margin: 6px 0; font-size: 15px; }
    .game-header { font-size: 20px; font-weight: bold; margin-bottom: 10px; text-align: center; }
  </style>
</head>
<body>

<!-- Sidebar -->
<div id="mySidebar" class="sidebar">
  <a href="javascript:void(0)" onclick="navigate('page1')">📦 Smart Bulk Recommendations</a>
  <a href="javascript:void(0)" onclick="navigate('page2')">⚠️ Waste Risk Predictor</a>
  <a href="javascript:void(0)" onclick="navigate('page3')">📊 Demand Forecast</a>
  <a href="javascript:void(0)" onclick="navigate('page4')">🏆 AI Leaderboard</a>
  <a href="javascript:void(0)" onclick="navigate('page5')">📉 Waste Forecast</a>
  <a href="javascript:void(0)" onclick="navigate('page6')">🎮 Simulation Game</a>
</div>

<!-- Top Buttons -->
<button class="openbtn" onclick="toggleSidebar()">☰</button>
<div class="bell-icon" onclick="toggleAlerts()">🔔</div>
<div id="alertBox" class="alert-box"></div>

<!-- Main Content -->
<div id="main">
  <div id="welcome" class="welcome">
    <h1>👋 Welcome to Walmart Waste Predictor</h1>
    <p>Click ☰ to explore our AI-powered dashboard.</p>
  </div>

  <!-- Pages -->
  <div class="page container" id="page1"><h2>Page 1</h2></div>
  <div class="page container" id="page2"><h2>Page 2</h2></div>
  <div class="page container" id="page3"><h2>Page 3</h2></div>
  <div class="page container" id="page4"><h2>Page 4</h2></div>
  <div class="page container" id="page5"><h2>Page 5</h2></div>

  <!-- === PAGE 6: RETAIL VIDEO GAME SIMULATION === -->
  <div class="page container" id="page6">
    <h2>🎮 Retail Rush: Build a Sustainable Empire</h2>
    <div class="sim-box">
      <div class="game-header">🛒 Day <span id="simDay">1</span> / 7 - <span id="eventLabel">🌞 Normal Day</span></div>
      <div class="store-scoreboard">
        <p>💰 Profit: ₹<span id="simProfit">0</span></p>
        <p>🧘 Karma: <span id="simKarma">0</span></p>
        <p>🗑️ Waste: <span id="simWaste">0</span> kg</p>
        <p>❤️ Donations: <span id="simDonate">0</span> kg</p>
        <p>🌍 Planet Mood: <span id="simMood">🙂</span></p>
      </div>

      <div class="upgrade-card">
        <strong>💡 Choose Your Upgrade:</strong><br><br>
        <button onclick="applyUpgrade('solar')">☀️ Solar Panels (+Karma)</button>
        <button onclick="applyUpgrade('cold')">❄️ Smart Cold Storage (-Waste)</button>
        <button onclick="applyUpgrade('donate')">🤝 NGO Partnership (+Donations)</button>
      </div>

      <br><button onclick="simulateDay()">▶️ Next Day</button>
      <button onclick="restartSim()">🔄 Restart Game</button>
    </div>
  </div>
</div>

<!-- JS -->
<script>
let simDay = 1, simProfit = 0, simWaste = 0, simDonate = 0, simKarma = 0;
let upgrades = { solar: false, cold: false, donate: false };

function simulateDay() {
  if (simDay > 7) return alert("🏁 Simulation complete. Restart to try again.");

  const event = getRandomEvent();
  document.getElementById("eventLabel").innerText = event.name;

  const inputs = {
    milk: Math.floor(Math.random() * 10 + 5),
    bananas: Math.floor(Math.random() * 20 + 5),
    bread: Math.floor(Math.random() * 15 + 5),
    veggies: Math.floor(Math.random() * 25 + 5)
  };

  fetch("http://localhost:5000/simulate_day", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ day: simDay, inputs: inputs, event: { spoiler: event.impact } })
  })
  .then(res => res.json())
  .then(data => {
    simProfit += data.profit;
    simWaste += data.waste_kg;
    simDonate += data.donation_kg;
    simKarma += data.karma;

    document.getElementById("simDay").innerText = simDay;
    document.getElementById("simProfit").innerText = simProfit;
    document.getElementById("simWaste").innerText = simWaste;
    document.getElementById("simDonate").innerText = simDonate;
    document.getElementById("simKarma").innerText = simKarma;
    document.getElementById("simMood").innerText = data.mood;

    simDay++;
  })
  .catch(err => alert("Simulation failed. Please ensure backend is running.\n" + err));
}

function getRandomEvent() {
  const events = [
    { name: "🌞 Normal Day", impact: 1.0 },
    { name: "🔥 Heatwave", impact: 1.6 },
    { name: "🌧️ Rainy Day", impact: 1.2 },
    { name: "⚡ Power Cut", impact: 1.4 },
    { name: "🎉 Festival Rush", impact: 0.7 }
  ];
  return events[Math.floor(Math.random() * events.length)];
}

function applyUpgrade(type) {
  if (upgrades[type]) return alert("Already activated!");
  upgrades[type] = true;
  alert(`✅ Upgrade activated: ${type}`);
}

function restartSim() {
  simDay = 1; simProfit = 0; simWaste = 0; simDonate = 0; simKarma = 0;
  upgrades = { solar: false, cold: false, donate: false };
  document.getElementById("simDay").innerText = simDay;
  document.getElementById("simProfit").innerText = 0;
  document.getElementById("simWaste").innerText = 0;
  document.getElementById("simDonate").innerText = 0;
  document.getElementById("simKarma").innerText = 0;
  document.getElementById("simMood").innerText = "🙂";
  document.getElementById("eventLabel").innerText = "🌞 Normal Day";
}

function toggleSidebar() {
  const bar = document.getElementById("mySidebar");
  bar.style.left = bar.style.left === "0px" ? "-250px" : "0px";
}
function navigate(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.getElementById("welcome").style.display = "none";
  document.getElementById("alertBox").style.display = "none";
  document.getElementById("mySidebar").style.left = "-250px";
}
function toggleAlerts() {
  const box = document.getElementById("alertBox");
  box.style.display = box.style.display === "block" ? "none" : "block";
  box.innerHTML = "<h4>⚠️ Alerts</h4><hr><p>No alerts right now.</p>";
}
</script>

</body>
</html>
